# Chapter 7

### π¤ΆΒ MySQL μ„λ²„μ λ°μ΄ν„° μ•”νΈν™”

- `MySQL 5.7` λ²„μ „λ¶€ν„° μ§€μ›λ `λ°μ΄ν„° μ•”νΈν™” κΈ°λ¥`μ€ μ²μμ—λ” **λ°μ΄ν„° νμΌμ— λ€ν•΄μ„λ§ μ•”νΈν™”**κ°€ κ°€λ¥ν–λ‹¤.
- `MySQL 8.0` λ²„μ „λ¶€ν„° `λ°μ΄ν„° νμΌ`κ³Ό `λ¦¬λ‘ λ΅κ·Έ`, `μ–Έλ‘ λ΅κ·Έ`, `λ°”μ΄λ„λ¦¬ λ΅κ·Έ` λ“±λ„ **μ•”νΈν™”κ°€ κ°€λ¥**ν•΄μ΅λ‹¤.

`MySQL μ„λ²„`μ μ•”νΈν™” κΈ°λ¥μ€ **λ°μ΄ν„°λ² μ΄μ¤ μ„λ²„μ™€ λ””μ¤ν¬ μ‚¬μ΄μ λ°μ΄ν„°λ¥Ό μ½κ³  μ“°λ” μ§€μ **μ—μ„

`μ•”νΈν™”` λλ” `λ³µνΈν™”`λ¥Ό μν–‰ν•λ‹¤.

`MySQL μ„λ²„`μ—μ„λ” `λ””μ¤ν¬ μ…μ¶λ ¥` μ΄μ™Έμ λ¶€λ¶„μ—λ” μ•”νΈν™” μ²λ¦¬κ°€ μ „ν€ ν•„μ”ν•μ§€ μ•λ‹¤.

λ”°λΌμ„ `MySQL μ„λ²„`μ **I/O λ μ΄μ–΄μ—μ„λ§ λ°μ΄ν„°μ μ•”νΈν™” λ° λ³µνΈν™” κ³Όμ •μ΄ μ‹¤ν–‰**λλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/d0cc3804-4e0a-434f-b141-96415a88bb3c)

`MySQL μ„λ²„`μ—μ„ `μ‚¬μ©μ`μ `μΏΌλ¦¬`λ¥Ό μ²λ¦¬ν•  λ• ν…μ΄λΈ” λ°μ΄ν„° μ•”νΈν™” μ—¬λ¶€λ” μ‹λ³„ν•  ν•„μ”κ°€ μ—†λ‹¤.

`μ•”νΈν™” λ ν…μ΄λΈ”`λ„ κ·Έλ ‡μ§€ μ•μ€ **ν…μ΄λΈ”κ³Ό λ™μΌν• μ²λ¦¬ κ³Όμ •**μ„ κ±°μΉκ² λλ‹¤.

`λ°μ΄ν„° μ•”νΈν™” κΈ°λ¥`μ΄ ν™μ„±ν™” λμ–΄ μλ‹¤κ³  ν•λ”λΌλ„ `MySQL` λ‚΄λ¶€μ™€ μ‚¬μ©μ μ…μ¥μ—μ„λ”

μ•„λ¬΄λ° μ°¨μ΄κ°€ μ—†κΈ° λ•λ¬Έμ— μ΄λ° `μ•”νΈν™” λ°©μ‹`μ„ `TDE`λΌκ³  λ¶€λ¥Έλ‹¤.

μ΄λ° μ•”νΈν™” λ°©μ‹μ„ `TDE` λλ” `Data at Rest Encryption` μ΄λΌκ³  λ¶€λ¥΄λ”λ°,

`MySQL λ©”λ‰΄μ–Ό`μ—μ„λ” `TDE`λΌλ” ν‘ν„μ„ μ‚¬μ©ν•λ‹¤.

### π¤©Β 2λ‹¨κ³„ ν‚¤ κ΄€λ¦¬

- `MySQL` μ„λ²„μ `TDE`μ—μ„ μ•”νΈν™” ν‚¤λ” `KeyRing` ν”λ¬κ·ΈμΈμ— μν•΄ κ΄€λ¦¬λλ‹¤.

`MySQL 8.0` λ²„μ „μ—μ„ μ§€μ›λλ” **ν‚¤λ§ ν”λ¬κ·ΈμΈμ€ μ΄ 4κ°€μ§€ μΆ…λ¥**κ°€ μλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/9b69dc84-2201-4981-99fb-d1edb9107ec8)

`MySQL` μ»¤λ®¤λ‹ν‹° μ—λ””μ…μ—μ„λ” `keyring_file` ν”λ¬κ·ΈμΈλ§ μ‚¬μ© κ°€λ¥ν•κ³ ,

μ—”ν„°ν”„λΌμ΄μ¦ μ—λ””μ…μ—μ„ λ‚λ¨Έμ§€ ν”λ¬κ·ΈμΈμ΄ μ‚¬μ© κ°€λ¥ν•λ‹¤.

λ‹¤μ–‘ν• `ν”λ¬κ·ΈμΈ`μ΄ μ κ³µλμ§€λ§ `λ§μ¤ν„° ν‚¤`λ¥Ό κ΄€λ¦¬ν•λ” λ°©λ²•λ§ λ‹¤λ¥΄κ³ ,

`MySQL μ„λ²„` λ‚΄λ¶€μ μΌλ΅ **μ‘λ™ν•λ” λ°©μ‹μ€ λ¨λ‘ λ™μΌ**ν•λ‹¤.

`MySQL μ„λ²„`μ ν‚¤λ§ ν”λ¬κ·ΈμΈμ€ `2λ‹¨κ³„ ν‚¤ κ΄€λ¦¬ λ°©μ‹`μ„ μ‚¬μ©ν•λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/7511b3df-f100-4d78-84aa-96325030913a)

`MySQL μ„λ²„`μ λ°μ΄ν„° μ•”νΈν™”λ” `Master Key`μ™€ `Tablespace Key`λ΅ κµ¬μ„±λκ³ ,

ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤λ” `Private Key` λΌκ³ λ„ λ¶€λ¥Έλ‹¤.

MySQL μ„λ²„λ” `HashiCorp Vault`μ™€ κ°™μ€ μ™Έλ¶€ ν‚¤ κ΄€λ¦¬ μ†”λ£¨μ… λλ” λ””μ¤ν¬μ νμΌμ—μ„ λ§μ¤ν„° ν‚¤λ¥Ό

κ°€μ Έμ¤κ³ , `μ•”νΈν™”λ ν…μ΄λΈ”`μ΄ μƒμ„±λ  λ•λ§λ‹¤ **μ„μμ ν…μ΄λΈ” μ¤νμ΄μ¤ ν‚¤λ¥Ό λ°κΈ‰**ν•λ‹¤.

μƒμ„±λ `λ§μ¤ν„° ν‚¤`λ¥Ό μ΄μ©ν•΄ **ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤λ¥Ό μ•”νΈν™”**ν•΄μ„ κ° ν…μ΄λΈ”μ `λ°μ΄ν„° νμΌ ν—¤λ”`μ— `μ €μ¥`ν•λ‹¤.

`ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤`λ” ν…μ΄λΈ”μ΄ μ‚­μ λμ§€ μ•λ” μ΄μƒ μ λ€ λ³€κ²½λμ§€ μ•λ”λ‹¤.

`ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤`λ” MySQL μ„λ²„ μ™Έλ¶€λ΅ λ…Έμ¶λμ§€ μ•μ•„μ„, λ³€κ²½ν•  μ΄μ κ°€ μ—†μ§€λ§

`λ§μ¤ν„° ν‚¤`λ” μ™Έλ¶€μ νμΌμ„ μ΄μ©ν•λ―€λ΅ **μ£ΌκΈ°μ μΌλ΅ λ³€κ²½**ν•΄μ•Ό ν•λ‹¤.

MySQL μ„λ²„μ `λ§μ¤ν„° ν‚¤`λ” μ•„λμ λ…λ Ήμ–΄λ΅ λ³€κ²½ν•  μ μλ‹¤.

```sql
mysql> ALTER INSTANCE ROTATE INNODB MASTER KEY;
```

`λ§μ¤ν„° ν‚¤`λ¥Ό λ³€κ²½ν•λ©΄ `MySQL μ„λ²„`λ” κΈ°μ΅΄μ λ§μ¤ν„° ν‚¤λ¥Ό μ΄μ©ν•΄ κ° ν…μ΄λΈ”μ ν…μ΄λΈ” μ¤νμ΄μ¤ ν‚¤λ¥Ό

λ³µνΈν™”ν•κ³ , `μƒλ΅μ΄ λ§μ¤ν„° ν‚¤`λ΅ λ‹¤μ‹ `μ•”νΈν™”`ν•λ‹¤.

`λ§μ¤ν„° ν‚¤`κ°€ λ³€κ²½λλ” λ™μ• MySQL μ„λ²„μ **ν…μ΄λΈ” μ¤νμ΄μ¤ ν‚¤ μμ²΄μ™€ λ°μ΄ν„° νμΌμ λ°μ΄ν„°λ” λ³€κ²½λμ§€ μ•λ”λ‹¤.**

`MySQL μ„λ²„`κ°€ 2λ‹¨κ³„ μ•”νΈν™” λ°©μ‹μ„ μ‚¬μ©ν•λ” μ΄μ λ” **μ•”νΈν™” ν‚¤ λ³€κ²½μΌλ΅ μΈν• μ‹μ¤ν… λ¶€ν•λ¥Ό ν”Όν•κΈ° μ„ν•΄μ„λ‹¤.**

`MySQL μ„λ²„`μ `TDE`μ—μ„ μ§€μ›λλ” μ•”νΈν™” μ•κ³ λ¦¬μ¦μ€ **AES 256λΉ„νΈμ΄κ³  λ‹¤λ¥Έ μ•κ³ λ¦¬μ¦μ€ μ§€μ›λμ§€ μ•λ”λ‹¤.**

### π›Β μ•”νΈν™”μ™€ μ„±λ¥

- `TDE λ°©μ‹μ μ•”νΈν™”`λ” `λ””μ¤ν¬`λ΅λ¶€ν„° **ν• λ² μ½μ€ λ°μ΄ν„° νμ΄μ§€λ” λ³µνΈν™” λμ–΄ λ²„νΌ ν’€μ— μ μ¬**λλ‹¤.
- `λ°μ΄ν„° νμ΄μ§€`κ°€ **ν• λ² λ©”λ¨λ¦¬μ— μ μ¬λλ©΄ μ•”νΈν™”λμ§€ μ•μ€ ν…μ΄λΈ”κ³Ό λ™μΌν• μ„±λ¥**μ„ λ³΄μΈλ‹¤.

`μΏΌλ¦¬`κ°€ InnoDB λ²„νΌ ν’€μ— μ΅΄μ¬ν•μ§€ μ•λ” `λ°μ΄ν„° νμ΄μ§€`λ¥Ό μ½μ–΄μ•Ό ν•λ” κ²½μ°λΌλ©΄,

`λ³µνΈν™” κ³Όμ •`μ„ κ±°μΉκΈ° λ•λ¬Έμ— **λ³µνΈν™” μ‹κ°„ λ™μ• μΏΌλ¦¬ μ²λ¦¬κ°€ μ§€μ—°**λλ‹¤.

`μ•”νΈν™”λ ν…μ΄λΈ”`μ΄ λ³€κ²½λλ©΄ λ‹¤μ‹ **λ””μ¤ν¬λ΅ λ™κΈ°ν™”λ  λ• μ•”νΈν™”**κ°€ λμ–΄μ•Ό ν•κΈ° λ•λ¬Έμ—

`λ””μ¤ν¬`μ— μ €μ¥ν•  λ•λ„ μ¶”κ°€λ΅ μ‹κ°„μ΄ λ” κ±Έλ¦΄ μ μλ‹¤.

`λ°μ΄ν„° νμ΄μ§€` μ €μ¥μ€ μ‚¬μ©μμ μΏΌλ¦¬λ¥Ό μ²λ¦¬ν•λ” μ¤λ λ“κ°€ μ•„λ‹ `λ°±κ·ΈλΌμ΄λ“ μ¤λ λ“`κ°€ μν–‰ν•κΈ° λ•λ¬Έμ—

**μ‹¤μ  μ‚¬μ©μμ μΏΌλ¦¬κ°€ μ§€μ—°**λλ” κ²ƒμ€ μ•„λ‹λ‹¤.

`μ΅°ν` μ‘μ—… λΏλ§ μ•„λ‹λΌ `λ³€κ²½`μ΄λ‚ `μ‚­μ ` μ‘μ—…λ„ λ³€κ²½ν•λ ¤λ” λ μ½”λ“λ¥Ό `λ²„νΌ ν’€`λ΅ μ½μ–΄μ™€μ•Ό ν•κΈ° λ–„λ¬Έμ—

μƒλ΅ μ½μ–΄μ•Ό ν•λ” `λ°μ΄ν„° νμ΄μ§€`μ κ°μμ— λ”°λΌμ„ **λ³µνΈν™” μ§€μ—°μ΄ λ°μƒ**ν•λ‹¤.

Β `AES` μ•”νΈν™” μ•κ³ λ¦¬μ¦μ€ μ•”νΈν™”ν•κ³ μ ν•λ” `ν‰λ¬Έμ κΈΈμ΄`κ°€ μ§§μΌλ©΄ μ•”νΈν™” ν‚¤μ ν¬κΈ°μ— λ”°λΌμ„,

`μ•”νΈν™”` λ κ²°κ³Όμ **μ©λ‰μ΄ λ” μ»¤μ§ μ μλ‹¤.**

λ°λ€λ΅ μ΄λ―Έ `λ°μ΄ν„° νμ΄μ§€`κ°€ `μ•”νΈν™” ν‚¤`λ³΄λ‹¤ ν›¨μ”¬ ν¬λ‹¤λ©΄ μ•”νΈν™” κ²°κ³Όκ°€ ν‰λ¬Έμ κ²°κ³Όμ™€

**λ™μΌν• ν¬κΈ°μ μ•”νΈλ¬Έμ„ λ°ν™**ν•λ‹¤.

λ”°λΌμ„ `TDE`λ¥Ό μ μ©ν•λ‹¤κ³  ν•΄λ„ `λ°μ΄ν„° νμΌ`μ ν¬κΈ°λ” μ•”νΈν™”λμ§€ μ•μ€ ν…μ΄λΈ”κ³Ό λ™μΌν• 

ν¬κΈ°λ¥Ό κ°€μ§€κ³ , `InnoDB λ²„νΌ ν’€`μ ν¨μ¨μ΄λ‚ `λ©”λ¨λ¦¬` μ‚¬μ© ν¨μ¨μ„ ν•΄μΉμ§€ μ•λ”λ‹¤.

κ°™μ€ `ν…μ΄λΈ”`μ— λ€ν•΄ `μ•”νΈν™”`μ™€ `μ••μ¶•`μ΄ λ™μ‹μ— μ μ©λλ©΄ MySQL μ„λ²„λ” **μ••μ¶•μ„ λ¨Όμ € μ‹¤ν–‰**ν•κ³ 

μ•”νΈν™”λ¥Ό μ μ©ν•λ‹¤. `μ••μ¶•`μ΄ `μ•”νΈν™”`λ³΄λ‹¤ λ¨Όμ € μ‹¤ν–‰λμ–΄μ•Ό ν•λ” μ΄μ λ” μ•„λμ™€ κ°™λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/524b9326-f78e-4637-930e-a4957f67db1a)

`μ•”νΈν™”` λ ν…μ΄λΈ”κ³Ό κ·Έλ ‡μ§€ μ•μ€ ν…μ΄λΈ”μ `λ””μ¤ν¬` **μ½κ³  μ“°κΈ°μ— κ±Έλ¦¬λ” ν‰κ·  μ‹κ°„**μ€ μ–Όλ§λ‚ μ°¨μ΄λ‚ κΉ?

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/65d2ff67-0772-48de-94c3-abeb76182c29)

`μ•”νΈν™” λ ν…μ΄λΈ”`μ κ²½μ° `μ½κΈ°`λ” **3~5λ°°**, `μ“°κΈ°`λ” **5~6λ°°** μ •λ„ λλ¦° κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

λ¬Όλ΅  μ΄ μμΉλ” `λ°€λ¦¬μ΄ λ‹¨μ„`μ΄λ―€λ΅ μ²΄κ°λμ§€ μ•μ„ μ μλ‹¤.

μ„μ ν‘λ” `performance_schema`μ `file_summary_by_instance` ν…μ΄λΈ”μ— μμ§‘λ κ²°κ³Όλ¥Ό μ΄μ©ν•΄

μ•„λμ μΏΌλ¦¬λ΅ μ΅°νν–λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/54d89295-c50f-49a7-85aa-a14e2ef36713)

### π¤¨Β μ•”νΈν™”μ™€ λ³µμ 

- `TDE`λ¥Ό μ΄μ©ν• μ•”νΈν™” μ‚¬μ©μ‹ `λ§μ¤ν„° ν‚¤`μ™€ `ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤`λ” MySQL μ„λ²„μ λ³µμ λ¥Ό μ‚¬μ©ν•΄λ„ λ§μ¤ν„° ν‚¤μ™€ ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤λ” λ™μΌν•μ§€ μ•μ„ μ μλ‹¤.
- `MySQL` μ„λ²„μ—μ„ κΈ°λ³Έμ μΌλ΅ `λ¨λ“  λ…Έλ“`λ” **κ°μμ λ§μ¤ν„° ν‚¤λ¥Ό ν• λ‹Ή**ν•΄μ•Ό ν•λ‹¤.

`λ°μ΄ν„°λ² μ΄μ¤ μ„λ²„`μ λ΅μ»¬ λ””λ ‰ν„°λ¦¬μ— `λ§μ¤ν„° ν‚¤`λ¥Ό κ΄€λ¦¬ν•λ” κ²½μ°μ—λ” `μ†μ¤ μ„λ²„`μ™€ `λ ν”λ¦¬μΉ΄ μ„λ²„`κ°€

**μ„λ΅ λ‹¤λ¥Έ ν‚¤**λ¥Ό κ°€μ§ μ λ°–μ— μ—†μ§€λ§, `μ›κ²© ν‚¤ κ΄€λ¦¬ μ†”λ£¨μ…`μ„ μ‚¬μ©ν•λ” κ²½μ°λΌλ„ `μ†μ¤ μ„λ²„`μ™€ `λ ν”λ¦¬μΉ΄ μ„λ²„`λ”

**μ„λ΅ λ‹¤λ¥Έ ν‚¤λ¥Ό λ§μ¤ν„° ν‚¤**λ¥Ό κ°€μ§€λ„λ΅ ν•΄μ•Όν•λ‹¤.

`μ†μ¤ μ„λ²„`μ™€ `λ ν”λ¦¬μΉ΄ μ„λ²„`λ” μ•”νΈν™” λκΈ° μ „μ κ°’μ΄ λ™μΌν•λ”λΌλ„ μ‹¤μ  μ•”νΈν™” λ λ°μ΄ν„°κ°€

μ €μ¥λ λ°μ΄ν„° νμΌμ λ‚΄μ©μ€ μ™„μ „ν λ‹¬λΌμ§„λ‹¤.

`λ³µμ  μ†μ¤`μ `λ§μ¤ν„° ν‚¤`λ¥Ό λ³€κ²½ν•  λ•λ” μ•„λμ λ…λ Ήμ„ μ‚¬μ©ν•λ‹¤.

```sql
mysql> ALTER INSTANCE ROTATE INNODB MASTER KEY
```

μ΄ λ…λ Ή μμ²΄λ” `λ ν”λ¦¬μΉ΄ μ„λ²„`λ΅ λ³µμ λμ§€λ§ 

μ‹¤μ  `μ†μ¤ μ„λ²„`μ `λ§μ¤ν„° ν‚¤` μμ²΄κ°€ λ ν”λ¦¬μΉ΄ μ„λ²„λ΅ μ „λ‹¬λλ” κ²ƒμ€ μ•„λ‹λ‹¤.

`λ§μ¤ν„° ν‚¤ λ΅ν…μ΄μ…`μ„ μ‹¤ν–‰ν•λ©΄ `μ†μ¤ μ„λ²„`μ™€ `λ ν”λ¦¬μΉ΄ μ„λ²„`κ°€ **κ°κ° μ„λ΅ λ‹¤λ¥Έ λ§μ¤ν„°ν‚¤λ¥Ό μƒλ΅ λ°κΈ‰** λ°›λ”λ‹¤.

`MySQL μ„λ²„`μ λ°±μ—…μ—μ„ `TDE`μ `ν‚¤λ§ νμΌ`μ„ **λ°±μ—…ν•μ§€ μ•λ” κ²½μ°**κ°€ μλ‹¤.

`ν‚¤λ§ νμΌ`μ„ μ°Ύμ§€ λ»ν•λ©΄ **λ°μ΄ν„° λ³µκµ¬λ¥Ό ν•  μ μ—†λ” λ¬Έμ **κ°€ μƒκΈΈ μ μλ‹¤.

λ¬Όλ΅  `λ³΄μ•`μ„ μ„ν•΄ `ν‚¤λ§ νμΌ`μ„ **λ°μ΄ν„° νμΌκ³Ό λ³„λ„λ΅ λ³΄κ΄€**ν•λ” κ²ƒμ΄ μΆ‹μ§€λ§, λ³µκµ¬λ¥Ό κ°μ•ν•΄μ„ λ°±μ—… λ°©μ‹μ„

μ •ν•λ” κ²ƒμ΄ μΆ‹λ‹¤.

### π¤“Β keyring_file ν”λ¬κ·ΈμΈ μ„¤μΉ

- `TDE`μ μ•”νΈν™” ν‚¤ κ΄€λ¦¬λ” `ν”λ¬κ·ΈμΈ λ°©μ‹`μΌλ΅ μ κ³µλλ‹¤.
- MySQL Community Editionμ€ `keyring_file` ν”λ¬κ·ΈμΈ μ‚¬μ©λ§ κ°€λ¥ν•λ‹¤.

`keyring_file` ν”λ¬κ·ΈμΈμ€ `ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤`λ¥Ό μ•”νΈν™”ν•κΈ° μ„ν• **λ§μ¤ν„° ν‚¤λ¥Ό λ””μ¤ν¬μ νμΌλ΅ κ΄€λ¦¬**ν•λ‹¤.

λ”°λΌμ„, `λ§μ¤ν„° ν‚¤`λ” `ν‰λ¬Έ`μΌλ΅ λ””μ¤ν¬μ— μ €μ¥λκΈ° λ•λ¬Έμ— `μ™Έλ¶€`μ— λ…Έμ¶λλ©΄ **μ•”νΈν™”λ” λ¬΄μ©μ§€λ¬Ό**μ΄ λλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/c9f0ffef-c510-40de-821e-78065a44dff6)

`MySQL μ„λ²„`μ λ‹¤λ¥Έ `ν”λ¬κ·ΈμΈ`κ³Όλ” λ‹¬λ¦¬ `TDE ν”λ¬κ·ΈμΈ`μ κ²½μ° κ°€μ¥ λΉ¨λ¦¬ μ΄κΈ°ν™”λμ–΄μ•Ό ν•λ‹¤.

λ”°λΌμ„ `my.cnf` νμΌμ `early-plugin-load` μ‹μ¤ν… λ³€μμ— **λΌμ΄λΈλ¬λ¦¬λ¥Ό λ…μ‹**ν•΄μ•Ό ν•λ‹¤.

`keyring_file` ν”λ¬κ·ΈμΈμ΄ λ§μ¤ν„° ν‚¤λ¥Ό μ €μ¥ν•  ν‚¤λ§ νμΌμ κ²½λ΅λ¥Ό `keyring_file_data` μ„¤μ •μ—

λ…μ‹ν•κ³ , `keyring_file_data`μ μ„¤μ • κ²½λ΅λ” **μ¤μ§ ν•λ‚μ MySQL μ„λ²„λ§ μ°Έμ΅°**ν•΄μ•Ό ν•λ‹¤.

ν•λ‚μ `λ¦¬λ…μ¤ μ„λ²„`μ— MySQL μ„λ²„κ°€ 2κ° μ΄μƒ μ‹¤ν–‰μ¤‘μ΄λΌλ©΄ κ° μ„λ²„κ°€ `μ„λ΅ λ‹¤λ¥Έ ν‚¤λ§ νμΌ`μ„ `μ‚¬μ©`ν•΄μ•Ό ν•λ‹¤.

```sql
early-plugin-load = keyring_file.so
keyring_file_data = /very/secure/directory/tde_master.key
```

`MySQL μ„λ²„`μ μ„¤μ • νμΌμ΄ μ¤€λΉ„λλ©΄ MySQL μ„λ²„λ¥Ό μ¬μ‹μ‘ν•λ©΄ μλ™μΌλ΅ `keyring_file` ν”λ¬κ·ΈμΈμ΄

μ΄κΈ°ν™”λκ³ , `keyring_file` ν”λ¬κ·ΈμΈμ μ΄κΈ°ν™” μ—¬λ¶€λ” `SHOW_PLUGINS` λ…λ ΉμΌλ΅ ν™•μΈν•  μ μλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/6cd22232-70d8-43c3-9ed6-4e0d2493061b)

`keyring_file` ν”λ¬κ·ΈμΈμ΄ μ΄κΈ°ν™”λλ©΄ MySQL μ„λ²„λ” **ν”λ¬κ·ΈμΈμ μ΄κΈ°ν™”**μ™€ λ™μ‹μ—,

`keyring_file_data` μ‹μ¤ν… λ³€μμ κ²½λ΅μ— λΉ νμΌμ„ μƒμ„±ν•λ‹¤.

`ν”λ¬κ·ΈμΈ`λ§ μ΄κΈ°ν™”λ μƒνƒμΌ λΏ, μ•„μ§ `λ§μ¤ν„° ν‚¤`λ¥Ό μ‚¬μ©ν• μ μ΄ μ—†μΌλ―€λ΅ **ν‚¤λ§ νμΌμ λ‚΄μ©μ€ λΉ„μ–΄μλ‹¤.**

`λ°μ΄ν„° μ•”νΈν™”` κΈ°λ¥μ„ μ‚¬μ©ν•λ” **ν…μ΄λΈ”μ„ μƒμ„±**ν•κ±°λ‚ 

`λ§μ¤ν„° λ΅ν…μ΄μ…`μ„ μ‹¤ν–‰ν• λ• **ν‚¤λ§ νμΌμ λ§μ¤ν„° ν‚¤κ°€ μ΄κΈ°ν™”**λλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/78a8032a-442c-44f7-8f9c-b18be8910951)

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/53b977ac-612f-4ce7-aa77-421fcbcd3e1f)

`ALTER INSTANCE ROTATE INNODB MASTER KEY` λ…λ Ήμ„ μ‹¤ν–‰ν•κ³  `λ°”μ΄λ„λ¦¬ λ΅κ·Έ`μ λ‚΄μ©μ„ μ‚΄ν΄λ³΄λ©΄

μ•„λμ μ‚¬μ§„κ³Ό κ°™λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/a2bab2a3-9d15-4272-93a5-e91decbb597f)

**ALTER INSTANCE ROTATE INNODB MASTER KEY** μ΄λ²¤νΈλ” `Event_type`μ΄ `Query`λ‹¤.

`λ§μ¤ν„° ν‚¤ λ΅ν…μ΄μ…`μ„ μ‹¤ν–‰ν•λ©΄ `SQL λ¬Έμ¥`μ΄ **λ ν”λ¦¬μΉ΄ μ„λ²„λ΅ μ „λ‹¬**λλ©°, μƒλ΅ μƒμ„±λ λ§μ¤ν„° ν‚¤μ κ°’μ΄ 

`λ°”μ΄λ„λ¦¬ λ΅κ·Έ`λ΅ μ „λ‹¬λμ§€ μ•λ”λ‹¤λ” κ²ƒμ„ μλ―Έν•λ‹¤.

### π‘Β ν…μ΄λΈ” μ•”νΈν™”

- `ν‚¤λ§ ν”λ¬κ·ΈμΈ`μ€ **λ§μ¤ν„° ν‚¤λ¥Ό μƒμ„±ν•κ³  κ΄€λ¦¬**ν•λ” λ¶€λ¶„κΉμ§€λ§ λ‹΄λ‹Ήν•λ‹¤.
- μ–΄λ–¤ `ν‚¤λ§ ν”λ¬κ·ΈμΈ`μ„ μ‚¬μ©ν•λ κ΄€κ³„μ—†μ΄ **μ•”νΈν™”λ ν…μ΄λΈ”μ„ μƒμ„±**ν•κ³  ν™μ©ν•λ” λ°©λ²•μ€ λ¨λ‘ λ™μΌν•λ‹¤.

`TDE`λ¥Ό μ΄μ©ν•λ” `ν…μ΄λΈ”`μ€ μ•„λμ™€ κ°™μ΄ μƒμ„±ν•  μ μλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/328f0b54-0fc9-4de1-87a7-1451a0ae39d7)

`TDE`λ¥Ό μ΄μ©ν•λ” `ν…μ΄λΈ”`μ„ μƒμ„±ν•λ ¤λ©΄ ν…μ΄λΈ” μƒμ„± κµ¬λ¬Έμ€ **μΌλ°μ μΈ ν…μ΄λΈ” μƒμ„± κµ¬λ¬Έκ³Ό λ™μΌ**ν•λ©°,

`ENCRYPTION=β€™Yβ€™` μµμ…λ§ λ§μ§€λ§‰μ— μ¶”κ°€λ΅ λ„£μ–΄μ£Όλ©΄ λλ‹¤.

μ΄λ ‡κ² μƒμ„±λ ν…μ΄λΈ”μ€ `λ°μ΄ν„°`κ°€ κΈ°λ΅λ  λ•λ” **μλ™μΌλ΅ μ•”νΈν™”**λκ³ , `λ©”λ¨λ¦¬`λ΅ **μ½μ–΄μ¬ λ•λ” λ³µνΈν™”** λλ‹¤.

`TDE`λ¥Ό μ΄μ©ν•λ” `ν…μ΄λΈ”`μ— λ°μ΄ν„°λ¥Ό ν•λ‚ λ„£κ³ , μ΅°νν•΄λ³΄λ©΄ κ²°κ³Όλ” μ•„λμ™€ κ°™λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/100ccbb7-f7f8-4393-8275-2585f52bda5d)

`MySQL` μ„λ²„μ—μ„ μ•”νΈν™” λ ν…μ΄λΈ”μ„ κ²€μƒ‰ν•κ³  μ‹¶μ„λ•λ” `information_schema`μ

`TABLES λ·°`λ¥Ό μ΄μ©ν•λ©΄ λλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/5f78ae65-cac6-4fde-ac62-8ac7f3bdb4d0)

μ΄ `μΏΌλ¦¬`λ¥Ό μ‘μ©ν•λ©΄ `μ•”νΈν™”`κ°€ μ μ©λ `ν…μ΄λΈ”`μ„ μ΅°νν•κ±°λ‚ κ·Έ `κ°―μ`λ¥Ό μ…€ μ μλ‹¤.

- `TDE`κ°€ μ μ©λ ν…μ΄λΈ” λ©λ΅ μ΅°ν

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/c5430ed5-09d1-469b-b14c-a5d6831fe175)

- `TDE`κ°€ μ μ©λ ν…μ΄λΈ” κ°μ μ΅°ν

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/8ff390c8-0d1c-4e7b-8ee1-42bf9135c23c)

`ν…μ΄λΈ”`μ„ μƒμ„±ν•  λ•λ§λ‹¤ `μ•”νΈν™” μµμ…`μ„ μ£Όκ² λλ©΄ λ„λ½ν•  κ°€λ¥μ„±μ΄ λ†’λ‹¤.

`default_table_encryption` μ‹μ¤ν… λ³€μλ¥Ό `ON`μΌλ΅ μ„¤μ •ν•λ©΄ **μ•”νΈν™”λ ν…μ΄λΈ”λ΅ μƒμ„±**λλ‹¤.

### πΒ μ‘μ© ν”„λ΅κ·Έλ¨ μ•”νΈν™”μ™€μ λΉ„κµ

- `μ‘μ© ν”„λ΅κ·Έλ¨`μ—μ„ μ§μ ‘ μ•”νΈν™”ν•΄μ„ MySQL μ„λ²„μ— μ €μ¥ν•λ” κ²½μ°, `MySQL μ„λ²„`λ” μ•”νΈν™” μ—¬λ¶€λ¥Ό μΈμ§€ν•μ§€ λ»ν•λ‹¤.
- `μ‘μ© ν”„λ΅κ·Έλ¨`μ—μ„ μ•”νΈν™”λ `μ»¬λΌ`μ€ μΈλ±μ¤λ¥Ό `μƒμ„±`ν•λ”λΌλ„ μΈλ±μ¤μ κΈ°λ¥μ„ 100% ν™μ©ν•  μ μ—†λ‹¤

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/59d598da-4733-4ee9-8ca6-e4b98f81325e)

μλ¥Ό λ“¤μ–΄ μ„μ™€ `κ°™μ€ ν…μ΄λΈ”`μ„ `μƒμ„±`ν–λ‹¤κ³  ν–μ„λ•,

`app_user` ν…μ΄λΈ”μ€ μ•”νΈν™”λμ–΄ μμ§€ μ•κ³  `enc_birth_year` μ»¬λΌμ€ **μ‘μ© ν”„λ΅κ·Έλ¨μ—μ„ μ΄λ―Έ μ•”νΈν™”**ν–λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/76ddf3f5-6a97-4c97-8e21-488e6557faa0)

`μ²« λ²μ§Έ μΏΌλ¦¬`μ™€ κ°™μ΄, **λ™μΌ κ°’λ§ κ²€μƒ‰ν•λ” μΏΌλ¦¬**μ—μ„λ” λ¬Έμ κ°€ μƒκΈ°μ§€ μ•κ³  μ •μƒ κ²€μƒ‰λλ‹¤.

ν•μ§€λ§ `μ¶μƒ μ—°λ„ λ²”μ„`λ΅ **μ‚¬μ©μλ¥Ό κ²€μƒ‰**ν•κ±°λ‚ `μ¶μƒ μ—°λ„`λ¥Ό **κΈ°μ¤€μΌλ΅ μ •λ ¬**ν•΄μ„ 

`μƒμ„ 10`κ°μ λ°μ΄ν„°λ§ μ΅°νν•λ” λ“± `λ™μΌ κ°’`μ„ μ΄μ©ν•λ” `μΏΌλ¦¬` μ΄μ™Έμ—λ” λ€λ¶€λ¶„ μ μ•½μ΄ μλ‹¤.

`μ‘μ© ν”„λ΅κ·Έλ¨`μ—μ„ μ§μ ‘ μ•”νΈν™”ν•μ§€ μ•κ³  `TDE`λ¥Ό μ‚¬μ©ν–λ‹¤λ©΄,

`μΈλ±μ¤` κ΄€λ ¨λ μ‘μ—…μ„ λ¨λ‘ μ²λ¦¬ν• ν›„ `μµμΆ… λ””μ¤ν¬`μ— λ°μ΄ν„° **νμ΄μ§€λ¥Ό μ €μ¥ν•  λ•λ§ μ•”νΈν™”**ν–μ„ κ²ƒμ΄λ‹¤.

`μ‘μ© ν”„λ΅κ·Έλ¨`μ μ•”νΈν™”μ™€ `MySQL` μ„λ²„μ μ•”νΈν™” κΈ°λ¥ μ¤‘ μ„ νƒν•΄μ•Ό ν•λ” μƒν™©μ΄λΌλ©΄

`MySQL` μ„λ²„μ **μ•”νΈν™” κΈ°λ¥μ„ μ„ νƒ**ν•λ” κ²ƒμ΄ μΆ‹λ‹¤.

`MySQL` μ„λ²„μ `TDE` κΈ°λ¥μ„ μ‚¬μ©ν•λ©΄ `MySQL` μ„λ²„μ— μ ‘κ·Όλ§ κ°€λ¥ν•λ‹¤λ©΄ **ν‰λ¬Έ λ°μ΄ν„°**λ¥Ό λ³Ό μ μλ‹¤.

ν•μ§€λ§ `μ‘μ© ν”„λ΅κ·Έλ¨ μ•”νΈν™”`μ κ²½μ° MySQL μ„λ²„μ— μ ‘κ·Όν•  μ μμ–΄λ„ **ν‰λ¬Έ λ°μ΄ν„°**λ¥Ό λ³Ό μ μ—†λ‹¤.

`μ‘μ© ν”„λ΅κ·Έλ¨`μ—μ„μ μ•”νΈν™” κΈ°λ¥μ€ **μ„λΉ„μ¤μ μ”κ±΄κ³Ό μ„±λ¥μ„ κ³ λ ¤ν•΄μ„ μ„ νƒ**ν•΄μ•Ό ν•κ³ ,

`MySQL μ„λ²„`μ μ•”νΈν™” κΈ°λ¥κ³Ό νΌν•©ν•΄μ„ μ‚¬μ©ν•λ©΄ **μ•μ „ν• μ„λΉ„μ¤λ¥Ό κµ¬μ¶•ν•λ” λ° λ„μ›€**μ΄ λ  κ²ƒμ΄λ‹¤.

### π²Β ν…μ΄λΈ”μ¤νμ΄μ¤ μ΄λ™

- `ν…μ΄λΈ”`μ„ λ‹¤λ¥Έ μ„λ²„λ΅ λ³µμ‚¬ν•΄μ•Ό ν•λ” κ²½μ°λ‚ `νΉμ • ν…μ΄λΈ”`μ λ°μ΄ν„° νμΌλ§ `λ°±μ—…`ν–λ‹¤κ°€ `λ³µκµ¬`ν•λ” κ²½μ°λΌλ©΄ `ν…μ΄λΈ” μ¤νμ΄μ¤` μ΄λ™ κΈ°λ¥μ΄ **λ μ½”λ“λ¥Ό λ¤ν”„ν–λ‹¤κ°€ λ³µκµ¬ν•λ” λ°©μ‹**λ³΄λ‹¤ ν›¨μ”¬ λΉ λ¥΄λ‹¤.
- `TDE`κ°€ μ μ©λμ–΄ μ•”νΈν™”λ ν…μ΄λΈ”μ κ²½μ° `μ›λ³Έ μ„λ²„`μ™€ `λ©μ μ§€ μ„λ²„`μ μ•”νΈν™” ν‚¤κ°€ λ‹¤λ¥΄κΈ° λ•λ¬Έμ— ν•λ‚ λ” μ‹ κ²½μ¨μ•Ό ν•  λ¶€λ¶„μ΄ μλ‹¤.

`ν…μ΄λΈ”μ¤νμ΄μ¤`λ¥Ό `μµμ¤ν¬νΈ(EXPORT)` ν•λ ¤λ©΄ μ•„λμ λ…λ ΉμΌλ΅ ν•  μ μλ‹¤.

```sql
mysql> FLUSH TABLES source_table FOR EXPORT;
```

μ΄ λ…λ Ήμ΄ μ‹¤ν–‰λλ©΄ `MySQL` μ„λ²„λ” `source_table`μ **μ €μ¥λμ§€ μ•μ€ λ³€κ²½ μ‚¬ν•­μ„ λ¨λ‘ λ””μ¤ν¬λ΅ κΈ°λ΅**ν•κ³ ,

`source_table`μ— λ” μ΄μƒ μ ‘κ·Όν•  μ μ—†λ„λ΅ μ κΈμ„ κ±΄λ‹¤.

`source_table`μ κµ¬μ΅°λ¥Ό `source_table.cfg` νμΌλ΅ κΈ°λ΅ν•΄λ‘κ³ ,

`source_table.ibd` νμΌκ³Ό `source_table.cfg` νμΌμ„ λ©μ μ§€ μ„λ²„λ΅ λ³µμ‚¬ν•λ‹¤.

λ³µμ‚¬κ°€ μ™„λ£λλ©΄ `UNLOCK TABLES` λ…λ Ήμ„ μ‹¤ν–‰ν•΄μ„ `source_table`μ„ μ‚¬μ©ν•  μ μλ„λ΅ ν•λ©΄ λλ‹¤.

μ΄ κ³Όμ •μ€ `μ•”νΈν™”` λμ§€ μ•μ€ ν…μ΄λΈ”μ ν…μ΄λΈ”μ¤νμ΄μ¤ λ³µμ‚¬ κ³Όμ •μ„ μ„¤λ…ν• λ‚΄μ©μ΄λ‹¤.

`TDE`λ΅ μ•”νΈν™” λ ν…μ΄λΈ”μ— λ€ν•΄μ„ `ν…μ΄λΈ”μ¤νμ΄μ¤` EXPORT λ…λ Ήμ„ ν•λ©΄

`MySQL` μ„λ²„λ” μ„μ‹λ΅ μ‚¬μ©ν•  `λ§μ¤ν„° ν‚¤`λ¥Ό λ°κΈ‰ν•΄μ„ **source_table.cfp νμΌλ΅ κΈ°λ΅**ν•λ‹¤.

μ•”νΈν™” λ `ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤`λ¥Ό **κΈ°μ΅΄ λ§μ¤ν„° ν‚¤λ΅ λ³µνΈν™”** ν•κ³ ,

μ„μ‹λ΅ λ°κΈ‰ν• `λ§μ¤ν„° ν‚¤`λ¥Ό μ΄μ©ν•΄ λ‹¤μ‹ μ•”νΈν™”ν•΄μ„ `λ°μ΄ν„° νμΌ`μ **ν—¤λ” λ¶€λ¶„μ— μ €μ¥**ν•΄λ‘”λ‹¤.

`μ•”νΈν™”` λ ν…μ΄λΈ”μ κ²½μ° `ν…μ΄λΈ”μ¤νμ΄μ¤` μ΄λ™ κΈ°λ¥μ„ μ‚¬μ©ν•  λ•λ” λ°λ“μ‹ λ°μ΄ν„° νμΌκ³Ό 

μ„μ‹ λ§μ¤ν„° ν‚¤κ°€ μ €μ¥λ `*.cfp` νμΌμ„ ν•¨κ» λ³µμ‚¬ν•΄μ•Ό ν•λ‹¤.

`*.cfg` νμΌμ€ λ‹¨μν ν…μ΄λΈ”μ κµ¬μ΅°λ§ κ°€μ§€κ³  μκΈ° λ•λ¬Έμ— `νμΌ`μ΄ μ—†μ–΄μ Έλ„ `κ²½κ³ `λ§ λ°μƒν•κ³ 

`ν…μ΄λΈ”μ¤νμ΄μ¤` λ³µκµ¬κ°€ κ°€λ¥ν•μ§€λ§ `*.cfp` νμΌμ΄ μ—†μ–΄μ§€λ©΄ **λ³µκµ¬κ°€ λ¶κ°€λ¥**ν•λ‹¤.

### π™ƒΒ μ–Έλ‘ λ΅κ·Έ λ° λ¦¬λ‘ λ΅κ·Έ μ•”νΈν™”

- `ν…μ΄λΈ” μ•”νΈν™”`λ¥Ό μ μ©ν•΄λ„ `λ°μ΄ν„° νμΌ` μ΄μ™Έμ **λ””μ¤ν¬ νμΌλ΅ κΈ°λ΅λλ” κ²½μ°μ—λ” ν‰λ¬ΈμΌλ΅ μ €μ¥**λλ‹¤.
- `ν…μ΄λΈ” μ•”νΈν™”`λ¥Ό μ μ©ν•΄λ„ **λ¦¬λ‘ λ΅κ·Έλ‚ μ–Έλ‘ λ΅κ·Έ, λ°”μ΄λ„λ¦¬ λ΅κ·Έμ—λ” ν‰λ¬ΈμΌλ΅ μ €μ¥**λλ‹¤.

`MySQL 8.0.16` λ²„μ „λ¶€ν„°λ” `innodb_undo_log_encrypt` μ‹μ¤ν… λ³€μμ™€ `innodb_redo_log_encrypt`

`μ‹μ¤ν… λ³€μ`λ¥Ό μ΄μ©ν•΄ **λ¦¬λ‘ λ΅κ·Έμ™€ μ–Έλ‘ λ΅κ·Έλ¥Ό μ•”νΈν™” λ μƒνƒλ΅ μ €μ¥**ν•  μ μκ² λμ—λ‹¤.

μ‹¤ν–‰μ¤‘μΈ `MySQL μ„λ²„`μ—μ„ **μ–Έλ‘ λ΅κ·Έλ‚ λ¦¬λ‘ λ΅κ·Έλ¥Ό ν™μ„±ν™”**ν•λ‹¤κ³  ν•λ”λΌλ„ λ¨λ“  λ¦¬λ‘ λ΅κ·Έλ‚ μ–Έλ‘ λ΅κ·Έμ

`λ°μ΄ν„°`λ¥Ό ν•΄λ‹Ή μ‹μ μ— **ν• λ²μ— μ•”νΈν™”ν•΄μ„ λ‹¤μ‹ μ €μ¥**ν•  μ μ—†λ‹¤.

`MySQL μ„λ²„`λ” μ•”νΈν™”κ°€ ν™μ„±ν™”λλ©΄ κ·Έλ•λ¶€ν„° μƒμ„±λλ” **λ¦¬λ‘ λ΅κ·Έλ‚ μ–Έλ‘ λ΅κ·Έλ§ μ•”νΈν™”ν•΄μ„ μ €μ¥**ν•λ‹¤.

λ°λ€λ΅ `μ•”νΈν™”`κ°€ λΉ„ν™μ„±ν™” λλ©΄ κ·Έλ•λ¶€ν„° μƒμ„±λλ” **λ¦¬λ‘ λ΅κ·Έλ‚ μ–Έλ‘ λ΅κ·Έλ” ν‰λ¬ΈμΌλ΅ μ €μ¥**ν•λ‹¤.

λ¦¬λ‘ λ΅κ·Έμ™€ μ–Έλ‘ λ΅κ·Έλ” μ•”νΈν™”λ¥Ό `λΉ„ν™μ„±ν™”`ν•λ‹¤κ³  ν•΄μ„ μ¦‰μ‹ μ•”νΈν™”μ— μ‚¬μ©λ ν‚¤κ°€ ν•„μ” μ—†μ–΄μ§€λ” κ²ƒμ€ μ•„λ‹λ‹¤.

νΉν `μ–Έλ‘ λ΅κ·Έ`λ” μ—¬μ „ν μ•”νΈν™” λ κ²ƒμ΄ μμ„ μ μκΈ° λ•λ¬Έμ— **λ©°μΉ  λλ” λ‡ λ‹¬ λ™μ• μ•”νΈν™” ν‚¤κ°€ ν•„μ”**ν•  μ μλ‹¤.

`λ¦¬λ‘ λ΅κ·Έ`μ™€ `μ–Έλ‘ λ΅κ·Έ` λ°μ΄ν„° λ¨λ‘ κ°κ°μ **ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤λ΅ μ•”νΈν™”** λκ³ ,

`ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤`λ” λ‹¤μ‹ **λ§μ¤ν„° ν‚¤λ΅ μ•”νΈν™”**λλ‹¤.

`ALTER INSTANCE ROTATE INNODB MASTER KEY` λ…λ Ήμ΄ μ‹¤ν–‰λλ©΄,

μƒλ΅μ΄ `λ§μ¤ν„° ν‚¤`κ°€ `λ°κΈ‰`λκ³  ν…μ΄λΈ” μ•”νΈν™”μ— μ‚¬μ©λ ν…μ΄λΈ”μ¤νμ΄μ¤ ν‚¤μ™€ λ™μΌν•κ² μƒλ΅μ΄ λ§μ¤ν„° ν‚¤μ— μν•΄

μ•”νΈν™”λλ‹¤.

`λ¦¬λ‘ λ΅κ·Έ`μ™€ `μ–Έλ‘ λ΅κ·Έ` νμΌμ„ μ„ν• ν”„λΌμ΄λΉ— ν‚¤κ°€ μ΅΄μ¬ν•κ³ , **ν”„λΌμ΄λΉ— ν‚¤λ” λ§μ¤ν„° ν‚¤λ΅ μ•”νΈν™”**λμ–΄ 

λ¦¬λ‘ λ΅κ·Έ νμΌκ³Ό μ–Έλ‘ λ΅κ·Έ νμΌμ `ν—¤λ”`μ— `μ €μ¥`λλ‹¤.

`λ¦¬λ‘ λ΅κ·Έ`κ°€ μ•”νΈν™” λμ—λ”μ§€ ν™•μΈν•λ ¤λ©΄ **μ‹μ¤ν… λ³€μλ΅ ν™•μΈ**ν•  μ μλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/c0744d7e-3383-48d4-9a61-5cd9b2d9f2d8)

`λ¦¬λ‘ λ΅κ·Έ μ•”νΈν™”` μ„¤μ •μ „μ— λ°μ΄ν„°λ¥Ό μ €μ¥ν•λ” κ²ƒκ³Ό,

`λ¦¬λ‘ λ΅κ·Έλ¥Ό μ•”νΈν™”` μ„¤μ •ν›„μ— λ°μ΄ν„°λ¥Ό μ €μ¥ν•λ” κ²ƒμ΄ μ–΄λ–»κ² λ‹¤λ¥Έμ§€ μ‚΄ν΄λ³΄λ©΄ μ•„λμ™€ κ°™λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/b6302610-61a3-4545-a9d9-d249b3a10cd5)

`INSERT` λ λ μ½”λ“μ λ¬Έμμ—΄μ΄ `InnoDB`μ λ¦¬λ‘ λ΅κ·Έμ— λ³΄μ΄λ”μ§€ `grep` λ…λ Ήμ–΄λ΅ ν™•μΈν•΄λ³΄λ©΄,

`μ•”νΈν™”` ν•κΈ° μ „μ— `INSERT`λ **Real-MySQL**μ€ κ²€μƒ‰λμ§€λ§ μ•”νΈν™” μ΄ν›„ `INSERT`λ Real-MongoDB λ¬Έμμ—΄μ€

κ²€μƒ‰μ΄ λμ§€ μ•λ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/d964803d-dad5-43dd-a525-c4ccfe61bad3)

### πΒ λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™”

- `ν…μ΄λΈ” μ•”νΈν™”`κ°€ μ μ©λΌλ„ **λ°”μ΄λ„λ¦¬ λ΅κ·Έλ” ν‰λ¬Έμ„ μ €μ¥**ν•λ‹¤.
- `λ°”μ΄λ„λ¦¬ λ΅κ·Έ`λ” μλ„μ μΌλ΅ μƒλ‹Ήν κΈ΄ μ‹κ°„ λ™μ• λ³΄κ΄€ν•λ” μ„λΉ„μ¤λ„ μκ³ , `μ¦λ¶„ λ°±μ—…`μ„ μ„ν•΄ λ°”μ΄λ„λ¦¬ λ΅κ·Έλ¥Ό λ³΄κ΄€ν•κΈ°λ„ ν•λ―€λ΅ **μ•”νΈν™”λ” μƒν™©μ— λ”°λΌ μ¤‘μ”λ„κ°€ λ†’μ•„μ§ μ μλ‹¤.**

`λ°”μ΄λ„λ¦¬ λ΅κ·Έ`μ™€ `λ¦΄λ μ΄ λ΅κ·Έ` νμΌ μ•”νΈν™” κΈ°λ¥μ€ **λ””μ¤ν¬μ— μ €μ¥λ λ΅κ·Έ νμΌμ— λ€ν• μ•”νΈν™”λ§ λ‹΄λ‹Ή**ν•λ‹¤.

`MySQL μ„λ²„`μ **λ©”λ¨λ¦¬ λ‚΄λ¶€** λλ” **μ†μ¤ μ„λ²„μ™€ λ ν”λ¦¬μΉ΄ μ„λ²„ κ°„μ λ„¤νΈμ›ν¬ κµ¬κ°„**μ—μ„ `λ΅κ·Έ λ°μ΄ν„°`λ¥Ό 

`μ•”νΈν™”` ν•κ³  μ‹¶λ‹¤λ©΄, `λ³µμ `λ¥Ό μ„ν• κ³„μ •μ΄ **SSLμ„ μ‚¬μ©ν•λ„λ΅ μ„¤μ •**ν•λ©΄ λλ‹¤.

### π¤¥Β λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤ κ΄€λ¦¬

- `λ°”μ΄λ„λ¦¬ λ΅κ·Έ`μ™€ `λ¦΄λ μ΄ λ΅κ·Έ νμΌ` λ°μ΄ν„°μ μ•”νΈν™”λ¥Ό μ„ν•΄μ„λ„ `MySQL μ„λ²„`λ” **2λ‹¨κ³„ μ•”νΈν™” ν‚¤ κ΄€λ¦¬ λ°©μ‹**μ„ μ‚¬μ©ν•λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/b10f02e0-90ff-4c61-a31f-6a959049ba56)

`λ°”μ΄λ„λ¦¬ λ΅κ·Έ`μ™€ `λ¦΄λ μ΄ λ΅κ·Έ νμΌ`μ λ°μ΄ν„°λ” **νμΌ ν‚¤λ΅ μ•”νΈν™”ν•΄μ„ λ””μ¤ν¬λ΅ μ €μ¥**ν•κ³ ,

`νμΌ ν‚¤`λ” `λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤`λ΅ μ•”νΈν™”ν•΄μ„ **κ° λ°”μ΄λ„λ¦¬ λ΅κ·Έμ™€ λ¦΄λ μ΄ λ΅κ·Έ νμΌμ ν—¤λ”μ— μ €μ¥**λλ‹¤.

`λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤`λ” ν…μ΄λΈ” μ•”νΈν™”μ `λ§μ¤ν„° ν‚¤`μ™€ λ™μΌν• μ—­ν• μ„ ν•κ³ , νμΌ ν‚¤λ” λ°”μ΄λ„λ¦¬ λ΅κ·Έμ™€ λ¦΄λ μ΄ λ΅κ·Έ `νμΌ λ‹¨μ„`λ΅ **μλ™μΌλ΅ μƒμ„±**λλ©° λ΅κ·Έ νμΌμ λ°μ΄ν„° μ•”νΈν™”μ—λ§ μ‚¬μ©λλ‹¤.

### π™‚Β λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤ λ³€κ²½

- `λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤`λ” λ‹¤μκ³Ό κ°™μ΄ λ³€κ²½ν•  μ μλ‹¤.

```sql
mysql> ALTER INSTANCE ROTATE BINLOG MASTER KEY;
```

`λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤` λ³€κ²½μ€ λ‹¤μμ κ³Όμ •μ„ κ±°μΉλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/dc041292-f386-4d73-89ac-1ed92a731d55)

μ΄ μ μ°¨μ—μ„ `4λ² κ³Όμ •`μ΄ μƒλ‹Ήν μ‹κ°„μ΄ κ±Έλ¦΄ μ μλ‹¤.

μ΄λ¥Ό μ™„ν™”ν•κΈ° μ„ν•΄ `ν‚¤λ§ νμΌ`μ—μ„ λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤λ” **λ‚΄λ¶€μ μΌλ΅ λ²„μ „ κ΄€λ¦¬**κ°€ μ΄λ£¨μ–΄μ§„λ‹¤.

`ALTER INSTANCE ROTATE BINLOG MASTER KEY` λ…λ Ήμ„ **μ—°μ†μΌλ΅ 2λ² μ‹¤ν–‰**ν•λ‹¤κ³  κ°€μ •ν•λ©΄,

`ν‚¤λ§ νμΌ`μ—λ” μμ°¨μ μΈ μ‹ν€€μ¤ λ²νΈλ¥Ό κ°€μ§€λ” **3κ°μ λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤κ°€ μ΅΄μ¬**ν•κ² λλ‹¤.

`λ°”μ΄λ„λ¦¬ λ΅κ·Έ`μ™€ `λ¦΄λ μ΄ λ΅κ·Έ νμΌ`λ“¤μ„ μµκ·Ό μμ„λ€λ΅ **νμΌ ν‚¤λ¥Ό λ‹¤μ‹ μ•”νΈν™”ν•΄μ„ μ €μ¥**ν•λ” μ‘μ—…μ„ ν•κ³ ,

λ¨λ“  `λ°”μ΄λ„λ¦¬ λ΅κ·Έ`μ™€ `λ¦΄λ μ΄ λ΅κ·Έ νμΌ`μ νμΌ ν‚¤κ°€ **μƒλ΅μ΄ λ°”μ΄λ„λ¦¬ ν‚¤λ΅ μ•”νΈν™”λμ–΄ μ €μ¥μ΄ μ™„λ£**λλ©΄

`κΈ°μ΅΄ λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤`λ” **ν‚¤λ§ νμΌμ—μ„ μ κ±°**λλ‹¤.

`λ°”μ΄λ„λ¦¬ λ΅κ·Έ νμΌ`μ μ•”νΈν™” μ—¬λ¶€λ” μ•„λμ λ…λ ΉμΌλ΅ ν™•μΈμ΄ κ°€λ¥ν•λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/85cf906d-5b2b-4d7c-b2f0-3fee16f69cf3)

### π‘ΏΒ mysqlbinlog λ„κµ¬ ν™μ©

- `MySQL μ„λ²„`μ—μ„λ” `νΈλμ­μ…`μ λ‚΄μ©μ„ μ¶”μ ν•κ±°λ‚ `λ°±μ—… λ³µκµ¬`λ¥Ό μ„ν•΄ μ•”νΈν™” λ `λ°”μ΄λ„λ¦¬ λ΅κ·Έ`λ¥Ό `ν‰λ¬Έ`μΌλ΅ `λ³µνΈν™”` ν•΄μ•Ό ν•λ” κ²½μ°κ°€ λ§λ‹¤.

`λ°”μ΄λ„λ¦¬ λ΅κ·Έ νμΌ`μ΄ μ•”νΈν™”λλ©΄ **λ°”μ΄λ„λ¦¬ λ΅κ·Έ μ•”νΈν™” ν‚¤κ°€ μ—†μΌλ©΄ λ³µνΈν™”κ°€ λ¶κ°€λ¥**ν•λ‹¤.

`μ•”νΈν™” ν‚¤`λ” MySQL μ„λ²„λ§ κ°€μ§€κ³  μκΈ° λ•λ¬Έμ— **λ³µνΈν™”κ°€ λ¶κ°€λ¥**ν•λ‹¤.

`mysqlbinlog` λ„κµ¬λ¥Ό μ΄μ©ν•΄ **μ•”νΈν™” λ λ°”μ΄λ„λ¦¬ λ΅κ·Έ νμΌμ λ‚΄μ©**μ„ `SQL λ¬Έμ¥`μΌλ΅ ν’€μ–΄λ³΄λ©΄,

μ•„λμ™€ κ°™μ΄ `μ•”νΈν™” λ λ°”μ΄λ„λ¦¬ λ΅κ·Έ νμΌ`μ„ **μ§μ ‘ μ—΄μ–΄ λ³Ό μ μ—†λ‹¤λ” μ—λ¬**λ¥Ό λ³΄κ²λλ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/05c09e3b-086f-432b-8e46-188a48e6e1fa)

`λ°”μ΄λ„λ¦¬ λ΅κ·Έ νμΌ`μ λ‚΄μ©μ„ λ³Ό μ μλ” λ°©λ²•μ€ **MySQL μ„λ²„λ¥Ό ν†µν•΄ κ°€μ Έμ¤λ” λ°©λ²•μ΄ μ μΌ**ν•λ‹¤.

`mysqlbinlog` λ„κµ¬κ°€ MySQL μ„λ²„μ— μ ‘μ†ν•΄μ„ `λ°”μ΄λ„λ¦¬ λ΅κ·Έ`λ¥Ό κ°€μ Έμ¤λ” λ°©λ²•μ΄ μµμ„ μ΄λ‹¤.

μ•„λμ λ…λ Ήμ–΄μ²λΌ `--read-from-remote-server` νλΌλ―Έν„°μ™€ ν•¨κ» **μ„λ²„ μ ‘μ† μ •λ³΄λ¥Ό μ…λ ¥**ν•΄μ•Ό ν•λ‹¤.

![image](https://github.com/AK-47-Study/real-mysql-study/assets/91787050/393fe942-3d7e-4318-a4b3-e80a9ed1003b)
